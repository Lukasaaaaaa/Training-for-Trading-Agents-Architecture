# Backtesting Configuration
# Last Updated: 2025-01-30

engine:
  type: vectorized  # or 'event_driven'
  parallel: true
  n_jobs: -1

initial_conditions:
  capital: 100000
  currency: USD
  position_sizing: from_risk_manager

transaction_costs:
  commission:
    type: percentage
    maker: 0.0002  # 0.02%
    taker: 0.0005  # 0.05%

  slippage:
    type: percentage
    value: 0.0001  # 0.01%
    model: random  # or 'volume_based', 'spread_based'

execution:
  fill_assumption: close  # or 'next_open', 'vwap'
  partial_fills: false
  order_types:
    - market
    - limit
    - stop

margin:
  enabled: true
  max_leverage: 3.0
  margin_call_threshold: 0.3
  interest_rate: 0.0  # simplified

walk_forward:
  method: anchored  # or 'rolling'
  optimization_window_days: 252
  test_window_days: 63
  step_size_days: 21
  min_trades_per_window: 30

  optimization:
    objective: sharpe_ratio  # or 'calmar', 'sortino', 'profit_factor'
    method: grid_search  # or 'optuna', 'genetic'
    n_trials: 100

  parameters_to_optimize:
    - name: signal_threshold
      range: [0.5, 0.8]
      step: 0.05
    - name: stop_loss_atr
      range: [1.0, 3.0]
      step: 0.5
    - name: take_profit_atr
      range: [1.5, 4.0]
      step: 0.5

out_of_sample:
  min_period_months: 6
  holdout_pct: 0.2
  blind_test: true

performance_metrics:
  return_metrics:
    - total_return
    - annualized_return
    - cagr
    - monthly_returns

  risk_metrics:
    - volatility
    - downside_deviation
    - max_drawdown
    - avg_drawdown
    - max_drawdown_duration
    - ulcer_index

  risk_adjusted:
    - sharpe_ratio
    - sortino_ratio
    - calmar_ratio
    - omega_ratio
    - information_ratio

  trade_metrics:
    - total_trades
    - win_rate
    - profit_factor
    - avg_win
    - avg_loss
    - largest_win
    - largest_loss
    - avg_trade_duration
    - avg_bars_in_trade

  distribution:
    - skewness
    - kurtosis
    - var_95
    - cvar_95
    - tail_ratio

validation_criteria:
  minimum_requirements:
    oos_sharpe: 1.0
    oos_win_rate: 0.45
    profit_factor: 1.3
    min_trades: 100
    max_drawdown: 0.20

  stability_checks:
    is_oos_sharpe_ratio: 0.7
    parameter_sensitivity: 0.3
    monthly_win_rate: 0.6
    regime_consistency: true

  overfitting_detection:
    pbo_threshold: 0.5
    deflated_sharpe_ratio: 1.0
    haircut_factor: 0.5

monte_carlo:
  enabled: true
  n_simulations: 1000
  methods:
    - trade_shuffling
    - return_bootstrapping
  confidence_level: 0.95

regime_analysis:
  enabled: true
  regimes:
    - bull_market
    - bear_market
    - sideways
    - high_volatility
    - low_volatility

reporting:
  generate_html: true
  generate_pdf: false
  include_charts: true
  output_path: /backtests/
